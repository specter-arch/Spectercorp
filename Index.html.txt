<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SpecterCorp Creator Pro</title>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<style>
body{
margin:0;
font-family:Arial;
background:linear-gradient(135deg,#0f0f1f,#1f1f3a);
color:white;
overflow-x:hidden;
}

header{
display:flex;
justify-content:space-between;
padding:20px;
background:rgba(0,0,0,0.6);
backdrop-filter:blur(12px);
position:fixed;
width:100%;
z-index:1000;
}

section{
padding:120px 10%;
}

button{
background:#8f7cff;
border:none;
padding:10px 20px;
border-radius:8px;
color:white;
cursor:pointer;
margin-top:10px;
}

input,textarea{
width:100%;
padding:10px;
margin:8px 0;
border-radius:8px;
border:none;
}

.card{
background:rgba(255,255,255,0.05);
padding:20px;
border-radius:15px;
margin-bottom:20px;
}

.hidden{display:none;}

.loader{
position:fixed;
top:0;
left:0;
width:100%;
height:100%;
background:black;
display:flex;
justify-content:center;
align-items:center;
z-index:2000;
}

.spinner{
width:60px;
height:60px;
border:6px solid #333;
border-top:6px solid #8f7cff;
border-radius:50%;
animation:spin 1s linear infinite;
}

@keyframes spin{
0%{transform:rotate(0deg);}
100%{transform:rotate(360deg);}
}

table{
width:100%;
border-collapse:collapse;
}

td,th{
padding:8px;
border-bottom:1px solid #333;
}
</style>
</head>

<body>

<div class="loader" id="loader">
<div class="spinner"></div>
</div>

<header>
<h2>SpecterCorp Creator Pro</h2>
<div>
<button onclick="upgrade()">Upgrade</button>
<button onclick="logout()">Logout</button>
</div>
</header>

<section id="authSection">
<h2>Login / Sign Up</h2>
<input id="email" type="email" placeholder="Email">
<input id="password" type="password" placeholder="Password">
<button onclick="signup()">Sign Up</button>
<button onclick="login()">Login</button>
</section>

<section id="dashboard" class="hidden">
<h2>Creator Dashboard</h2>

<div class="card">
<h3>AI Script Generator</h3>
<textarea id="scriptPrompt" placeholder="Describe your cinematic idea"></textarea>
<button onclick="generateScript()">Generate Script</button>
<p id="scriptResult"></p>
<button onclick="downloadPDF()">Download as PDF</button>
</div>

<div class="card">
<h3>Kling AI Video Generator</h3>
<textarea id="videoPrompt" placeholder="Enter cinematic video prompt"></textarea>
<button onclick="generateVideo()">Generate Video</button>
<p id="videoResult"></p>
</div>

<div class="card">
<h3>Your Credits: <span id="creditDisplay">0</span></h3>
</div>

<div class="card">
<h3>Your Projects</h3>
<table>
<thead>
<tr>
<th>Type</th>
<th>Prompt</th>
<th>Status</th>
</tr>
</thead>
<tbody id="projectTable"></tbody>
</table>
</div>

</section>

<script>

// LOADER
window.onload=()=>{
document.getElementById("loader").classList.add("hidden");
};

// <script type="module">
  // Import the functions you need from the SDKs you need
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
  // TODO: Add SDKs for Firebase products that you want to use
  // https://firebase.google.com/docs/web/setup#available-libraries

  // Your web app's Firebase configuration
  const firebaseConfig = {
    apiKey: "AIzaSyDpPnJ12qWIf9rdKB1uApHv5mgZuG7k5Xs",
    authDomain: "specter-corp.firebaseapp.com",
    projectId: "specter-corp",
    storageBucket: "specter-corp.firebasestorage.app",
    messagingSenderId: "534159933427",
    appId: "1:534159933427:web:ed8b9c1fa3f88808561c86"
  };

  // Initialize Firebase
  const app = initializeApp(firebaseConfig);
</script>

const auth=firebase.auth();
const db=firebase.firestore();

const BACKEND="https://https://spectercorp-backend.onrender.com";

// AUTH
function signup(){
auth.createUserWithEmailAndPassword(email.value,password.value)
.then(userCredential=>{
db.collection("users").doc(userCredential.user.uid).set({
credits:5,
plan:"Free"
});
});
}

function login(){
auth.signInWithEmailAndPassword(email.value,password.value);
}

function logout(){
auth.signOut();
}

auth.onAuthStateChanged(user=>{
if(user){
authSection.classList.add("hidden");
dashboard.classList.remove("hidden");
loadCredits();
loadProjects();
}else{
authSection.classList.remove("hidden");
dashboard.classList.add("hidden");
}
});

// CREDIT CHECK
async function checkCredits(){
let user=auth.currentUser;
let doc=await db.collection("users").doc(user.uid).get();
let credits=doc.data().credits;

if(credits<=0){
alert("No credits left. Upgrade.");
return false;
}

await db.collection("users").doc(user.uid).update({
credits:credits-1
});

return true;
}

async function loadCredits(){
let user=auth.currentUser;
let doc=await db.collection("users").doc(user.uid).get();
document.getElementById("creditDisplay").innerText=doc.data().credits;
}

// SCRIPT GENERATION
async function generateScript(){
if(!(await checkCredits())) return;

let prompt=document.getElementById("scriptPrompt").value;
document.getElementById("scriptResult").innerText="Generating...";

let response=await fetch(`${BACKEND}/generate-script`,{
method:"POST",
headers:{"Content-Type":"application/json"},
body:JSON.stringify({prompt})
});

let data=await response.json();
document.getElementById("scriptResult").innerText=data.script;

saveProject("Script",prompt);
loadCredits();
}

// VIDEO GENERATION
async function generateVideo(){
if(!(await checkCredits())) return;

let prompt=document.getElementById("videoPrompt").value;
document.getElementById("videoResult").innerText="Generating...";

let response=await fetch(`${BACKEND}/generate-video`,{
method:"POST",
headers:{"Content-Type":"application/json"},
body:JSON.stringify({prompt})
});

await response.json();
document.getElementById("videoResult").innerText="Video Generated";

saveProject("Video",prompt);
loadCredits();
}

// SAVE PROJECT
function saveProject(type,prompt){
let user=auth.currentUser;
db.collection("projects").add({
uid:user.uid,
type:type,
prompt:prompt,
status:"Generated",
timestamp:Date.now()
});
}

// LOAD PROJECTS
function loadProjects(){
let user=auth.currentUser;
db.collection("projects")
.where("uid","==",user.uid)
.orderBy("timestamp","desc")
.onSnapshot(snapshot=>{
let table="";
snapshot.forEach(doc=>{
let d=doc.data();
table+=`<tr>
<td>${d.type}</td>
<td>${d.prompt}</td>
<td>${d.status}</td>
</tr>`;
});
document.getElementById("projectTable").innerHTML=table;
});
}

// PDF DOWNLOAD
async function downloadPDF(){
let content=document.getElementById("scriptResult").innerText;

let response=await fetch(`${BACKEND}/generate-pdf`,{
method:"POST",
headers:{"Content-Type":"application/json"},
body:JSON.stringify({content})
});

let blob=await response.blob();
let link=document.createElement("a");
link.href=window.URL.createObjectURL(blob);
link.download="script.pdf";
link.click();
}

// STRIPE UPGRADE
async function upgrade(){
let response=await fetch(`${BACKEND}/create-checkout-session`,{
method:"POST"
});
let data=await response.json();
window.location.href=data.url;
}

</script>

</body>
</html>


